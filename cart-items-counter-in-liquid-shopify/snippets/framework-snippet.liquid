<div id="framework-snippet">
    <div id="counter"></div>
{% if template.name == "product" %}
<div id="add-to-cart-button" data-variant-id="{{ product.variants[0].id }}" data-product-title="{{ product.title }}"></div>
{% endif %}
<p>framework</p>
<script>
    const scripts=[ "{{ vite-counter.js | asset_url }}" ];
<script type="module" src="{{ 'vite-counter.js' | asset_url }}" defer></script>
{% if template.name == "product" %}
scripts.push("{{ 'vite-add-to-cart-button.js' | asset_url }}");
{% endif %}
console.log(scripts)
const observer= new IntersectionObserver((entries, observer)=>{
    if(entries[0.isIntersecting){
        for(const script of scripts){
            const scriptElement=document.createElement("script");
            scriptElement.type="module";
            scriptElement.setAttribute("src", script);
            scriptElement.setAttribute("defer", "defer");
            document.body.appendChild(scriptElement);
        }
        console.log("scripts added")
        observer.disconnect();
    }
}, { threshold: 1 });
observer.observe(document.querySelector("#framework-snippet"));
</script>
</div>